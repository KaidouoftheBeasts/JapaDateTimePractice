<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fecha y Hora en Japon√©s</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; display: flex; justify-content: center; align-items: center; padding: 20px; }
        .container { background-color: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1); padding: 30px; max-width: 700px; width: 100%; text-align: center; }
        h1 { color: #333; margin-bottom: 20px; font-size: 28px; }
        .current-time { font-size: 18px; color: #666; margin-bottom: 30px; }
        .buttons-container { display: flex; justify-content: center; gap: 15px; margin-bottom: 30px; flex-wrap: wrap; }
        .option-button { background-color: #4a6fa5; color: white; border: none; border-radius: 10px; padding: 12px 20px; font-size: 16px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(74, 111, 165, 0.3); flex: 1; min-width: 120px; max-width: 200px; }
        .option-button:hover { background-color: #3a5a80; transform: translateY(-2px); box-shadow: 0 6px 8px rgba(74, 111, 165, 0.4); }
        .option-button:active { transform: translateY(0); }
        .option-button.active { background-color: #2a4a70; box-shadow: 0 2px 4px rgba(74, 111, 165, 0.5); }
        .display-area { background-color: #f8f9fa; border-radius: 10px; padding: 20px; margin-bottom: 30px; border-left: 4px solid #4a6fa5; }
        .writing-system { margin-bottom: 20px; }
        .writing-system:last-child { margin-bottom: 0; }
        .system-name { font-weight: bold; color: #4a6fa5; margin-bottom: 5px; font-size: 16px; }
        .japanese-text { font-size: 20px; color: #333; min-height: 30px; padding: 8px; background-color: white; border-radius: 5px; box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05); line-height: 1.5; }
        .kanji { font-family: 'MS Mincho', 'SimSong', serif; font-size: 22px; }
        .hiragana { font-family: 'MS Gothic', 'SimHei', sans-serif; }
        .speak-button { background-color: #4a6fa5; color: white; border: none; border-radius: 50px; padding: 15px 30px; font-size: 18px; cursor: pointer; transition: all 0.3s ease; box-shadow: 0 4px 6px rgba(74, 111, 165, 0.3); display: flex; align-items: center; justify-content: center; margin: 0 auto; }
        .speak-button:hover { background-color: #3a5a80; transform: translateY(-2px); box-shadow: 0 6px 8px rgba(74, 111, 165, 0.4); }
        .speak-button:active { transform: translateY(0); }
        .speak-button:disabled { background-color: #cccccc; cursor: not-allowed; transform: none; box-shadow: none; }
        .button-icon { margin-right: 10px; font-size: 20px; }
        .loading { display: none; width: 20px; height: 20px; border: 2px solid #f3f3f3; border-top: 2px solid #4a6fa5; border-radius: 50%; animation: spin 1s linear infinite; margin-right: 10px; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        .voice-selector { margin: 15px 0; padding: 10px; background-color: #f0f8ff; border-radius: 5px; }
        .voice-selector select { padding: 8px; border-radius: 5px; border: 1px solid #ccc; width: 100%; max-width: 300px; }
        .status { margin: 10px 0; padding: 8px; border-radius: 5px; font-size: 14px; }
        .status.success { background-color: #d4edda; color: #155724; border: 1px solid #c3e6cb; }
        .status.warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffeaa7; }
        .footer { margin-top: 20px; color: #888; font-size: 14px; }
        @media (max-width: 480px) {
            .container { padding: 20px; }
            h1 { font-size: 24px; }
            .buttons-container { flex-direction: column; align-items: center; }
            .option-button { max-width: 100%; }
            .japanese-text, .kanji { font-size: 18px; }
            .speak-button { padding: 12px 25px; font-size: 16px; }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Fecha y Hora en Japon√©s</h1>
        <div class="current-time" id="currentTime">Cargando...</div>
        
        <div class="buttons-container">
            <button class="option-button active" id="datetimeButton">Fecha y Hora</button>
            <button class="option-button" id="dateButton">Solo Fecha</button>
            <button class="option-button" id="timeButton">Solo Hora</button>
        </div>
        
        <div class="display-area" id="displayArea">
            <div class="writing-system">
                <div class="system-name">Romaji (Alfabeto latino)</div>
                <div class="japanese-text" id="romajiDisplay">-</div>
            </div>
            <div class="writing-system">
                <div class="system-name">Kanji (Caracteres chinos)</div>
                <div class="japanese-text kanji" id="kanjiDisplay">-</div>
            </div>
            <div class="writing-system">
                <div class="system-name">Hiragana (Silabario japon√©s)</div>
                <div class="japanese-text hiragana" id="hiraganaDisplay">-</div>
            </div>
        </div>
        
        <div class="voice-selector" id="voiceSelector">
            <label for="voiceSelect">Seleccionar voz japonesa:</label>
            <select id="voiceSelect"><option value="">Buscando voces japonesas...</option></select>
        </div>
        
        <div id="voiceStatus" class="status warning">Cargando voces disponibles...</div>
        
        <button class="speak-button" id="speakButton" disabled>
            <div class="loading" id="loadingSpinner"></div>
            <span class="button-icon">üó£Ô∏è</span> 
            <span id="buttonText">Esperando voces...</span>
        </button>
        
        <div class="footer">Actualizado a agosto de 2025 - Minutos completamente corregidos</div>
    </div>

    <script>
        // Variables globales
        let voices = [], japaneseVoices = [], voicesLoaded = false, currentMode = 'datetime';

        // Datos optimizados
        const specialDays = {
            1: { kanji: "‰∏ÄÊó•", hiragana: "„Å§„ÅÑ„Åü„Å°", romaji: "tsuitachi" },
            2: { kanji: "‰∫åÊó•", hiragana: "„Åµ„Å§„Åã", romaji: "futsuka" },
            3: { kanji: "‰∏âÊó•", hiragana: "„Åø„Å£„Åã", romaji: "mikka" },
            4: { kanji: "ÂõõÊó•", hiragana: "„Çà„Å£„Åã", romaji: "yokka" },
            5: { kanji: "‰∫îÊó•", hiragana: "„ÅÑ„Å§„Åã", romaji: "itsuka" },
            6: { kanji: "ÂÖ≠Êó•", hiragana: "„ÇÄ„ÅÑ„Åã", romaji: "muika" },
            7: { kanji: "‰∏ÉÊó•", hiragana: "„Å™„ÅÆ„Åã", romaji: "nanoka" },
            8: { kanji: "ÂÖ´Êó•", hiragana: "„Çà„ÅÜ„Åã", romaji: "y≈çka" },
            9: { kanji: "‰πùÊó•", hiragana: "„Åì„Åì„ÅÆ„Åã", romaji: "kokonoka" },
            10: { kanji: "ÂçÅÊó•", hiragana: "„Å®„Åä„Åã", romaji: "t≈çka" },
            14: { kanji: "ÂçÅÂõõÊó•", hiragana: "„Åò„ÇÖ„ÅÜ„Çà„Å£„Åã", romaji: "j≈´ yokka" },
            20: { kanji: "‰∫åÂçÅÊó•", hiragana: "„ÅØ„Å§„Åã", romaji: "hatsuka" },
            24: { kanji: "‰∫åÂçÅÂõõÊó•", hiragana: "„Å´„Åò„ÇÖ„ÅÜ„Çà„Å£„Åã", romaji: "nij≈´ yokka" }
        };

        const amPm = { 
            am: { kanji: "ÂçàÂâç", hiragana: "„Åî„Åú„Çì", romaji: "gozen" }, 
            pm: { kanji: "ÂçàÂæå", hiragana: "„Åî„Åî", romaji: "gogo" } 
        };
        
        const numbers = {
            0: { kanji: "„Äá", hiragana: "„Çå„ÅÑ", romaji: "rei" }, 
            1: { kanji: "‰∏Ä", hiragana: "„ÅÑ„Å°", romaji: "ichi" },
            2: { kanji: "‰∫å", hiragana: "„Å´", romaji: "ni" }, 
            3: { kanji: "‰∏â", hiragana: "„Åï„Çì", romaji: "san" },
            4: { kanji: "Âõõ", hiragana: "„Çà„Çì", romaji: "yon" }, 
            5: { kanji: "‰∫î", hiragana: "„Åî", romaji: "go" },
            6: { kanji: "ÂÖ≠", hiragana: "„Çç„Åè", romaji: "roku" }, 
            7: { kanji: "‰∏É", hiragana: "„Å™„Å™", romaji: "nana" },
            8: { kanji: "ÂÖ´", hiragana: "„ÅØ„Å°", romaji: "hachi" }, 
            9: { kanji: "‰πù", hiragana: "„Åç„ÇÖ„ÅÜ", romaji: "ky≈´" },
            10: { kanji: "ÂçÅ", hiragana: "„Åò„ÇÖ„ÅÜ", romaji: "j≈´" }
        };

        const months = {
            1: { kanji: "‰∏ÄÊúà", hiragana: "„ÅÑ„Å°„Åå„Å§", romaji: "ichigatsu" }, 
            2: { kanji: "‰∫åÊúà", hiragana: "„Å´„Åå„Å§", romaji: "nigatsu" },
            3: { kanji: "‰∏âÊúà", hiragana: "„Åï„Çì„Åå„Å§", romaji: "sangatsu" }, 
            4: { kanji: "ÂõõÊúà", hiragana: "„Åó„Åå„Å§", romaji: "shigatsu" },
            5: { kanji: "‰∫îÊúà", hiragana: "„Åî„Åå„Å§", romaji: "gogatsu" }, 
            6: { kanji: "ÂÖ≠Êúà", hiragana: "„Çç„Åè„Åå„Å§", romaji: "rokugatsu" },
            7: { kanji: "‰∏ÉÊúà", hiragana: "„Åó„Å°„Åå„Å§", romaji: "shichigatsu" }, 
            8: { kanji: "ÂÖ´Êúà", hiragana: "„ÅØ„Å°„Åå„Å§", romaji: "hachigatsu" },
            9: { kanji: "‰πùÊúà", hiragana: "„Åè„Åå„Å§", romaji: "kugatsu" }, 
            10: { kanji: "ÂçÅÊúà", hiragana: "„Åò„ÇÖ„ÅÜ„Åå„Å§", romaji: "j≈´gatsu" },
            11: { kanji: "ÂçÅ‰∏ÄÊúà", hiragana: "„Åò„ÇÖ„ÅÜ„ÅÑ„Å°„Åå„Å§", romaji: "j≈´ichigatsu" }, 
            12: { kanji: "ÂçÅ‰∫åÊúà", hiragana: "„Åò„ÇÖ„ÅÜ„Å´„Åå„Å§", romaji: "j≈´nigatsu" }
        };

        const weekdays = [
            { kanji: "Êó•ÊõúÊó•", hiragana: "„Å´„Å°„Çà„ÅÜ„Å≥", romaji: "nichiy≈çbi" }, 
            { kanji: "ÊúàÊõúÊó•", hiragana: "„Åí„Å§„Çà„ÅÜ„Å≥", romaji: "getsuy≈çbi" },
            { kanji: "ÁÅ´ÊõúÊó•", hiragana: "„Åã„Çà„ÅÜ„Å≥", romaji: "kay≈çbi" }, 
            { kanji: "Ê∞¥ÊõúÊó•", hiragana: "„Åô„ÅÑ„Çà„ÅÜ„Å≥", romaji: "suiy≈çbi" },
            { kanji: "Êú®ÊõúÊó•", hiragana: "„ÇÇ„Åè„Çà„ÅÜ„Å≥", romaji: "mokuy≈çbi" }, 
            { kanji: "ÈáëÊõúÊó•", hiragana: "„Åç„Çì„Çà„ÅÜ„Å≥", romaji: "kin'y≈çbi" },
            { kanji: "ÂúüÊõúÊó•", hiragana: "„Å©„Çà„ÅÜ„Å≥", romaji: "doy≈çbi" }
        ];

        // Funci√≥n corregida para d√≠as del mes
        const getDayPronunciation = (day) => {
            if (specialDays[day]) return specialDays[day];
            
            if (day <= 10) {
                return {
                    kanji: numbers[day].kanji + "Êó•",
                    hiragana: numbers[day].hiragana + "„Å´„Å°",
                    romaji: numbers[day].romaji + " nichi"
                };
            }
            
            const tens = Math.floor(day / 10);
            const ones = day % 10;
            
            if (ones === 0) {
                return {
                    kanji: numbers[tens].kanji + "ÂçÅÊó•",
                    hiragana: numbers[tens].hiragana + "„Åò„ÇÖ„ÅÜ„Å´„Å°",
                    romaji: numbers[tens].romaji + "j≈´ nichi"
                };
            } else {
                return {
                    kanji: numbers[tens].kanji + "ÂçÅ" + numbers[ones].kanji + "Êó•",
                    hiragana: numbers[tens].hiragana + "„Åò„ÇÖ„ÅÜ" + numbers[ones].hiragana + "„Å´„Å°",
                    romaji: numbers[tens].romaji + "j≈´" + numbers[ones].romaji + " nichi"
                };
            }
        };

        // Funci√≥n COMPLETAMENTE CORREGIDA para minutos
        const getMinutePronunciation = (minutes) => {
            if (minutes === 0) return { romaji: "", hiragana: "", kanji: "" };
            
            // CASOS ESPECIALES √öNICOS
            if (minutes === 1) return { romaji: "ippun", hiragana: "„ÅÑ„Å£„Å∑„Çì", kanji: "‰∏ÄÂàÜ" };
            if (minutes === 6) return { romaji: "roppun", hiragana: "„Çç„Å£„Å∑„Çì", kanji: "ÂÖ≠ÂàÜ" };
            if (minutes === 8) return { romaji: "happun", hiragana: "„ÅØ„Å£„Å∑„Çì", kanji: "ÂÖ´ÂàÜ" };
            if (minutes === 10) return { romaji: "juppun", hiragana: "„Åò„ÇÖ„Å£„Å∑„Çì", kanji: "ÂçÅÂàÜ" };
            
            // DECENAS ESPECIALES
            if (minutes === 20) return { romaji: "nijuppun", hiragana: "„Å´„Åò„ÇÖ„Å£„Å∑„Çì", kanji: "‰∫åÂçÅÂàÜ" };
            if (minutes === 30) return { romaji: "sanjuppun", hiragana: "„Åï„Çì„Åò„ÇÖ„Å£„Å∑„Çì", kanji: "‰∏âÂçÅÂàÜ" };
            if (minutes === 40) return { romaji: "yonjuppun", hiragana: "„Çà„Çì„Åò„ÇÖ„Å£„Å∑„Çì", kanji: "ÂõõÂçÅÂàÜ" };
            if (minutes === 50) return { romaji: "gojuppun", hiragana: "„Åî„Åò„ÇÖ„Å£„Å∑„Çì", kanji: "‰∫îÂçÅÂàÜ" };
            
            // Para n√∫meros simples (2-9)
            if (minutes < 10) {
                const isSpecial = [1, 3, 4, 6, 8].includes(minutes);
                const pronunciation = isSpecial ? "pun" : "fun";
                const hiraganaEnd = isSpecial ? "„Å∑„Çì" : "„Åµ„Çì";
                
                return {
                    romaji: numbers[minutes].romaji + pronunciation,
                    hiragana: numbers[minutes].hiragana + hiraganaEnd,
                    kanji: numbers[minutes].kanji + "ÂàÜ"
                };
            }
            
            // Para n√∫meros de 11-59 (excluyendo los casos especiales ya tratados)
            const tens = Math.floor(minutes / 10);
            const ones = minutes % 10;
            
            // CORRECCI√ìN CR√çTICA: Aplicar pronunciaci√≥n especial para 1, 6, 8 en las unidades
            if (ones === 0) {
                // Para n√∫meros como 20, 30, 40, 50 ya est√°n definidos arriba
                return {
                    romaji: (tens === 1 ? "j≈´" : numbers[tens].romaji + "j≈´") + "fun",
                    hiragana: numbers[tens].hiragana + "„Åò„ÇÖ„ÅÜ„Åµ„Çì",
                    kanji: numbers[tens].kanji + "ÂçÅÂàÜ"
                };
            } else {
                // DETERMINAR PRONUNCIACI√ìN CORRECTA SEG√öN EL √öLTIMO D√çGITO
                let onesPronunciation;
                let onesHiragana;
                
                switch(ones) {
                    case 1:
                        onesPronunciation = "ippun"; // NO "ichipun"
                        onesHiragana = "„ÅÑ„Å£„Å∑„Çì";
                        break;
                    case 3:
                        onesPronunciation = "sanpun";
                        onesHiragana = "„Åï„Çì„Å∑„Çì";
                        break;
                    case 4:
                        onesPronunciation = "yonpun";
                        onesHiragana = "„Çà„Çì„Å∑„Çì";
                        break;
                    case 6:
                        onesPronunciation = "roppun"; // NO "rokupun"
                        onesHiragana = "„Çç„Å£„Å∑„Çì";
                        break;
                    case 8:
                        onesPronunciation = "happun"; // NO "hachipun"
                        onesHiragana = "„ÅØ„Å£„Å∑„Çì";
                        break;
                    default:
                        // Para 2, 5, 7, 9
                        onesPronunciation = numbers[ones].romaji + "fun";
                        onesHiragana = numbers[ones].hiragana + "„Åµ„Çì";
                }
                
                const tensPart = tens === 1 ? "j≈´" : numbers[tens].romaji + "j≈´";
                const tensHiragana = numbers[tens].hiragana + "„Åò„ÇÖ„ÅÜ";
                
                return {
                    romaji: tensPart + onesPronunciation,
                    hiragana: tensHiragana + onesHiragana,
                    kanji: numbers[tens].kanji + "ÂçÅ" + numbers[ones].kanji + "ÂàÜ"
                };
            }
        };

        const convertNumberToJapanese = (num, type = 'general') => {
            if (type === 'day') return getDayPronunciation(num);
            if (type === 'minutes') return getMinutePronunciation(num);
            
            if (type === 'hours') {
                let hour = num > 12 ? num - 12 : (num === 0 ? 12 : num);
                if (hour === 4) return { kanji: "Âõõ", hiragana: "„Çà", romaji: "yo" };
                if (hour === 7) return { kanji: "‰∏É", hiragana: "„Åó„Å°", romaji: "shichi" };
                if (hour === 9) return { kanji: "‰πù", hiragana: "„Åè", romaji: "ku" };
                return numbers[hour] || { kanji: hour.toString(), hiragana: hour.toString(), romaji: hour.toString() };
            }
            
            if (num <= 10) return numbers[num];
            
            if (num < 100) {
                const tens = Math.floor(num / 10), ones = num % 10;
                return {
                    kanji: numbers[tens].kanji + "ÂçÅ" + (ones ? numbers[ones].kanji : ""),
                    hiragana: numbers[tens].hiragana + "„Åò„ÇÖ„ÅÜ" + (ones ? numbers[ones].hiragana : ""),
                    romaji: numbers[tens].romaji + "j≈´" + (ones ? numbers[ones].romaji : "")
                };
            }
            
            if (type === 'year') {
                if (num === 2025) return { kanji: "‰∫åÂçÉ‰∫åÂçÅ‰∫î", hiragana: "„Å´„Åõ„Çì„Å´„Åò„ÇÖ„ÅÜ„Åî", romaji: "nisen nij≈´go" };
                const yearStr = num.toString();
                return { 
                    kanji: yearStr.split('').map(d => numbers[d]?.kanji || d).join(''),
                    hiragana: yearStr.split('').map(d => numbers[d]?.hiragana || d).join(''),
                    romaji: yearStr.split('').map(d => numbers[d]?.romaji || d).join('')
                };
            }
            
            return { kanji: num.toString(), hiragana: num.toString(), romaji: num.toString() };
        };

        const formatJapaneseDateTime = (date, mode) => {
            const year = date.getFullYear(), month = date.getMonth() + 1, day = date.getDate();
            const weekday = date.getDay(), hours = date.getHours(), minutes = date.getMinutes();
            
            const period = hours >= 12 ? amPm.pm : amPm.am;
            const displayHours = hours === 0 ? 12 : (hours > 12 ? hours - 12 : hours);
            
            const yearJ = convertNumberToJapanese(year, 'year');
            const monthJ = months[month];
            const dayJ = convertNumberToJapanese(day, 'day');
            const hoursJ = convertNumberToJapanese(displayHours, 'hours');
            const minutesJ = convertNumberToJapanese(minutes, 'minutes');
            const weekdayJ = weekdays[weekday];
            
            let romaji = "", kanji = "", hiragana = "", speechText = "";
            
            switch(mode) {
                case 'datetime':
                    romaji = `${yearJ.romaji}nen ${monthJ.romaji} ${dayJ.romaji} (${weekdayJ.romaji}) ${period.romaji} ${hoursJ.romaji}ji ${minutesJ.romaji}`;
                    kanji = `${yearJ.kanji}Âπ¥${monthJ.kanji}${dayJ.kanji}Ôºà${weekdayJ.kanji}Ôºâ${period.kanji}${hoursJ.kanji}ÊôÇ${minutesJ.kanji}`;
                    hiragana = `${yearJ.hiragana}„Å≠„Çì ${monthJ.hiragana} ${dayJ.hiragana}Ôºà${weekdayJ.hiragana}Ôºâ${period.hiragana}${hoursJ.hiragana}„Åò${minutesJ.hiragana}`;
                    speechText = `${yearJ.romaji}„Å≠„Çì ${monthJ.romaji} ${dayJ.romaji}„ÄÅ${weekdayJ.romaji}„ÄÅ${period.romaji} ${hoursJ.romaji}„Åò${minutes > 0 ? ` ${minutesJ.romaji}` : ''}`;
                    break;
                case 'date':
                    romaji = `${yearJ.romaji}nen ${monthJ.romaji} ${dayJ.romaji} (${weekdayJ.romaji})`;
                    kanji = `${yearJ.kanji}Âπ¥${monthJ.kanji}${dayJ.kanji}Ôºà${weekdayJ.kanji}Ôºâ`;
                    hiragana = `${yearJ.hiragana}„Å≠„Çì ${monthJ.hiragana} ${dayJ.hiragana}Ôºà${weekdayJ.hiragana}Ôºâ`;
                    speechText = `${yearJ.romaji}„Å≠„Çì ${monthJ.romaji} ${dayJ.romaji}„ÄÅ${weekdayJ.romaji}`;
                    break;
                case 'time':
                    romaji = `${period.romaji} ${hoursJ.romaji}ji ${minutesJ.romaji}`;
                    kanji = `${period.kanji}${hoursJ.kanji}ÊôÇ${minutesJ.kanji}`;
                    hiragana = `${period.hiragana}${hoursJ.hiragana}„Åò${minutesJ.hiragana}`;
                    speechText = `${period.romaji} ${hoursJ.romaji}„Åò${minutes > 0 ? ` ${minutesJ.romaji}` : ''}`;
                    break;
            }
            
            return { romaji, kanji, hiragana, speechText };
        };

        const updateDisplay = (mode = 'datetime') => {
            const currentDateTime = new Date();
            const japaneseDateTime = formatJapaneseDateTime(currentDateTime, mode);
            
            document.getElementById('currentTime').textContent = 
                currentDateTime.toLocaleDateString('es-ES', { 
                    weekday: 'long', year: 'numeric', month: 'long', day: 'numeric',
                    hour: '2-digit', minute: '2-digit', hour12: true 
                });
            
            document.getElementById('romajiDisplay').textContent = japaneseDateTime.romaji;
            document.getElementById('kanjiDisplay').textContent = japaneseDateTime.kanji;
            document.getElementById('hiraganaDisplay').textContent = japaneseDateTime.hiragana;
            
            currentMode = mode;
            
            document.querySelectorAll('.option-button').forEach(btn => {
                btn.classList.remove('active');
            });
            document.getElementById(mode + 'Button').classList.add('active');
        };

        const loadVoices = () => {
            voices = speechSynthesis.getVoices();
            japaneseVoices = voices.filter(voice => 
                voice.lang.startsWith('ja') || voice.lang.includes('JP') || 
                voice.name.toLowerCase().includes('japan') || voice.name.toLowerCase().includes('japanese')
            );
            
            const voiceSelect = document.getElementById('voiceSelect');
            const voiceStatus = document.getElementById('voiceStatus');
            const speakButton = document.getElementById('speakButton');
            const buttonText = document.getElementById('buttonText');
            
            voiceSelect.innerHTML = '';
            
            if (japaneseVoices.length > 0) {
                japaneseVoices.forEach((voice, i) => {
                    voiceSelect.innerHTML += `<option value="${i}">${voice.name} (${voice.lang})</option>`;
                });
                
                voiceStatus.textContent = `‚úì ${japaneseVoices.length} voces japonesas encontradas`;
                voiceStatus.className = 'status success';
                speakButton.disabled = false;
                buttonText.textContent = 'Decir en japon√©s';
                voicesLoaded = true;
            } else {
                voiceSelect.innerHTML = '<option value="">No se encontraron voces japonesas</option>';
                voiceStatus.textContent = '‚úó No hay voces japonesas. Se usar√° voz por defecto.';
                voiceStatus.className = 'status warning';
                speakButton.disabled = false;
                buttonText.textContent = 'Decir en japon√©s (voz por defecto)';
                voicesLoaded = false;
            }
        };

        const speakJapaneseDateTime = () => {
            if (!currentMode) return;
            
            const currentDateTime = new Date();
            const japaneseDateTime = formatJapaneseDateTime(currentDateTime, currentMode);
            const button = document.getElementById('speakButton');
            const buttonText = document.getElementById('buttonText');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            button.disabled = true;
            loadingSpinner.style.display = 'block';
            buttonText.textContent = 'Hablando...';
            
            speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(japaneseDateTime.speechText);
            utterance.lang = 'ja-JP';
            utterance.rate = 0.8;
            
            if (voicesLoaded) {
                const selectedIndex = parseInt(document.getElementById('voiceSelect').value);
                if (selectedIndex >= 0 && japaneseVoices[selectedIndex]) {
                    utterance.voice = japaneseVoices[selectedIndex];
                }
            }
            
            utterance.onend = () => {
                button.disabled = false;
                loadingSpinner.style.display = 'none';
                buttonText.textContent = voicesLoaded ? 'Decir en japon√©s' : 'Decir en japon√©s (voz por defecto)';
            };
            
            utterance.onerror = (event) => {
                console.error('Error en speech synthesis:', event);
                button.disabled = false;
                loadingSpinner.style.display = 'none';
                buttonText.textContent = voicesLoaded ? 'Decir en japon√©s' : 'Decir en japon√©s (voz por defecto)';
            };
            
            setTimeout(() => speechSynthesis.speak(utterance), 100);
        };

        // Inicializaci√≥n
        document.addEventListener('DOMContentLoaded', () => {
            speechSynthesis.onvoiceschanged = loadVoices;
            loadVoices();
            
            document.getElementById('datetimeButton').addEventListener('click', () => updateDisplay('datetime'));
            document.getElementById('dateButton').addEventListener('click', () => updateDisplay('date'));
            document.getElementById('timeButton').addEventListener('click', () => updateDisplay('time'));
            
            document.getElementById('speakButton').addEventListener('click', speakJapaneseDateTime);
            
            updateDisplay('datetime');
            setInterval(() => updateDisplay(currentMode), 60000);
        });
    </script>
</body>
</html>